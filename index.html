<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº²çˆ±çš„è€å©†å¦‡å¥³èŠ‚å¿«ä¹ï¼â¤ï¸</title>
    <style>
        /* é€šç”¨æ ·å¼ */
        body {
            background: linear-gradient(135deg, #ff9a9e, #fad0c4);
            font-family: 'Microsoft YaHei', sans-serif;
            text-align: center;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }

        .stage {
            display: none;
            max-width: 600px;
            margin: 0 auto;
        }

        .stage.active {
            display: block;
        }

        /* çˆ±å¿ƒæ ·å¼ */
        #heartContainer {
            position: relative;
            height: 400px;
            margin: 0 auto;
        }

        .heart {
            color: #ff3366;
            font-size: 2em;
            cursor: pointer;
            transition: all 0.3s;
            position: absolute;
        }

        .heart-counter {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
        }

        /* æ‹¼å›¾æ ·å¼ */
        #puzzle {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
            width: 300px;
            margin: 20px auto;
        }

        .puzzle-piece {
            width: 100%;
            height: 100px;
            object-fit: cover;
            border: 2px solid white;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .puzzle-piece.selected {
            opacity: 0.7;
            box-shadow: 0 0 0 3px #ff69b4;
        }

        /* æœ€ç»ˆé¡µé¢ */
        #finalMessage {
            background: rgba(255,255,255,0.9);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(255,51,102,0.2);
            margin-top: 30px;
            display: none;
        }

        /* è¾“å…¥æ¡†æ ·å¼ */
        #codeInput {
            font-size: 24px;
            padding: 10px;
            border: 2px solid pink;
            border-radius: 8px;
            width: 120px;
            text-align: center;
        }

        /* éŸ³ä¹æ§åˆ¶æŒ‰é’® */
        #musicControl {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            background-color: rgba(255, 255, 255, 0.7);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            z-index: 1000;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            font-size: 20px;
        }

        /* åŠ¨ç”» */
        @keyframes float {
            0% { transform: translateY(0) scale(1); opacity: 1 }
            100% { transform: translateY(-100px) scale(0); opacity: 0 }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .pulse {
            animation: pulse 1s infinite;
        }

        /* ç§»åŠ¨ç«¯é€‚é… */
        @media (max-width: 600px) {
            h2 { font-size: 1.2em; }
            .puzzle-piece { height: 80px; }
            #musicControl { top: 10px; right: 10px; }
        }
    </style>
</head>
<body>
    <!-- éŸ³ä¹æ§åˆ¶ -->
    <div id="musicControl" onclick="toggleMusic()">ğŸ”‡</div>
    <audio id="bgMusic" loop preload="auto">
        <source src="https://sx-sycdn.kuwo.cn/305c9ee2d68f9eb7530dd04ca210e33b/67cc2b5a/resource/n2/94/70/4115957726.mp3?bitrate$128&from=vip" type="audio/mpeg">
        æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘å…ƒç´ ã€‚
    </audio>

    <!-- ç¬¬ä¸€å…³ï¼šçˆ±å¿ƒæ”¶é›† -->
    <div id="stage1" class="stage active">
        <h2 style="color:#ff3366">â¤ï¸ ç¬¬ä¸€å…³ï¼šæ”¶é›†æˆ‘çš„çˆ±å¿ƒ â¤ï¸</h2>
        <p>ç‚¹å‡»æ”¶é›†10é¢—çˆ±å¿ƒï¼Œè§£é”ç¥ç¦</p>
        <div id="heartContainer">
            <div class="heart-counter">å·²æ”¶é›†: <span id="heartCount">0</span>/10</div>
        </div>
    </div>

    <!-- ç¬¬äºŒå…³ï¼šè®°å¿†æ‹¼å›¾ -->
    <div id="stage2" class="stage">
        <h2 style="color:#ff69b4">ğŸŒ¸ ç¬¬äºŒå…³ï¼šæ‹¼å‡‘ç¾å¥½å›å¿† ğŸŒ¸</h2>
        <div id="puzzle"></div>
    </div>

    <!-- ç¬¬ä¸‰å…³ï¼šç»ˆæç¥ç¦ -->
    <div id="stage3" class="stage">
        <h2 style="color:#e75480">ğŸ‰ æœ€åå…³å¡ï¼šè¾“å…¥çˆ±çš„å¯†ç  ğŸ‰</h2>
        <p>è¯·è¾“å…¥æˆ‘ä»¬çš„çºªå¿µæ—¥ï¼ˆMMDDæ ¼å¼ï¼‰ï¼š</p>
        <input type="number" id="codeInput" maxlength="4" placeholder="MMDD">
        <div id="finalMessage">
            <h3>â¤ï¸ äº²çˆ±çš„è€å©† â¤ï¸</h3>
            <p style="font-size:20px; line-height:1.6">
                æ„Ÿè°¢ä½ è®©å¹³å‡¡çš„æ—¥å­é—ªé—ªå‘å…‰<br>
                æ„¿æœªæ¥çš„æ¯ä¸€å¤©éƒ½æœ‰ä½ çš„ç¬‘å®¹ç›¸ä¼´<br>
                ä½ æ°¸è¿œæ˜¯æˆ‘ç”Ÿå‘½ä¸­æœ€ç¾çš„ç¤¼ç‰©ï¼ğŸ
            </p>
            <div id="fireworks"></div>
        </div>
    </div>

    <script>
        // éŸ³ä¹æ§åˆ¶
        const bgMusic = document.getElementById('bgMusic');
        const musicControl = document.getElementById('musicControl');
        let isMusicPlaying = false;

        function toggleMusic() {
            if (isMusicPlaying) {
                bgMusic.pause();
                musicControl.textContent = 'ğŸ”‡';
                musicControl.classList.remove('pulse');
                isMusicPlaying = false;
            } else {
                // å°è¯•æ’­æ”¾éŸ³ä¹
                const playPromise = bgMusic.play();
                
                if (playPromise !== undefined) {
                    playPromise.then(_ => {
                        // æ’­æ”¾æˆåŠŸ
                        musicControl.textContent = 'ğŸµ';
                        musicControl.classList.add('pulse');
                        isMusicPlaying = true;
                    })
                    .catch(error => {
                        // è‡ªåŠ¨æ’­æ”¾è¢«é˜»æ­¢ï¼Œæç¤ºç”¨æˆ·
                        alert('è¯·ç‚¹å‡»éŸ³ä¹æŒ‰é’®å¼€å§‹æ’­æ”¾èƒŒæ™¯éŸ³ä¹');
                    });
                }
            }
        }

        // ç¡®ä¿åœ¨é¡µé¢åŠ è½½åå°è¯•åˆå§‹åŒ–éŸ³ä¹
        document.addEventListener('DOMContentLoaded', function() {
            // åœ¨å¾®ä¿¡ä¸­ï¼Œéœ€è¦ç”¨æˆ·äº¤äº’æ‰èƒ½æ’­æ”¾éŸ³é¢‘
            // æ·»åŠ æç¤ºåŠ¨ç”»ï¼Œå¸å¼•ç”¨æˆ·ç‚¹å‡»
            musicControl.classList.add('pulse');
            
            // é¢„åŠ è½½éŸ³é¢‘
            bgMusic.load();
        });

        // å…¨å±€æ§åˆ¶é€»è¾‘
        const stages = {
            current: 1,
            next() {
                document.querySelector(`#stage${this.current}`).classList.remove('active');
                this.current++;
                document.querySelector(`#stage${this.current}`).classList.add('active');
            }
        };

        // ç¬¬ä¸€å…³é€»è¾‘ï¼šçˆ±å¿ƒæ”¶é›†
        let heartCount = 0;
        const heartContainer = document.getElementById('heartContainer');
        const heartCountElement = document.getElementById('heartCount');
        
        function createHearts() {
            // æ¸…ç©ºç°æœ‰çš„å¿ƒ
            while (heartContainer.firstChild) {
                if (heartContainer.firstChild.className === 'heart-counter') {
                    break;
                }
                heartContainer.removeChild(heartContainer.firstChild);
            }
            
            // åˆ›å»ºæ–°çš„å¿ƒ
            for (let i = 0; i < 20; i++) {
                const heart = document.createElement('div');
                heart.className = 'heart';
                heart.innerHTML = 'â¤ï¸';
                heart.style.left = Math.random() * 80 + '%';
                heart.style.top = Math.random() * 70 + '%';
                
                heart.addEventListener('click', () => {
                    heart.style.transform = 'scale(1.5)';
                    setTimeout(() => heart.remove(), 300);
                    heartCount++;
                    heartCountElement.textContent = heartCount;
                    
                    // å¦‚æœè¿˜æ²¡æœ‰æ’­æ”¾éŸ³ä¹ï¼Œå°è¯•åœ¨ç¬¬ä¸€æ¬¡äº¤äº’æ—¶æ’­æ”¾
                    if (!isMusicPlaying) {
                        toggleMusic();
                    }
                    
                    if (heartCount >= 10) {
                        setTimeout(() => {
                            alert('ğŸ‰ æ”¶é›†æˆåŠŸï¼ä½ æ€»æ˜¯èƒ½æ¸©æš–æˆ‘çš„å¿ƒ');
                            stages.next();
                            initPuzzle();
                        }, 300);
                    }
                });
                
                heartContainer.appendChild(heart);
            }
        }

        // åˆå§‹åŒ–ç¬¬ä¸€å…³
        createHearts();

        // ç¬¬äºŒå…³é€»è¾‘ï¼šæ‹¼å›¾æ¸¸æˆ
        const puzzleContainer = document.getElementById('puzzle');
        let selectedPiece = null;
        
        // æ‹¼å›¾å›¾ç‰‡æ•°æ®
        const puzzlePieces = [
            { id: 0, src: "https://hebbkx1anhila5yf.public.blob.vercel-storage.com/puzzle-piece-1.jpg-lTREgdlG8mZY4C27VhmNKQcOcX5oxm.png", correctPosition: 0 },
            { id: 1, src: "https://hebbkx1anhila5yf.public.blob.vercel-storage.com/puzzle-piece-2.jpg-5wAT9WshmDbczm0Rqmi8D4f1yi62Iz.png", correctPosition: 1 },
            { id: 2, src: "https://hebbkx1anhila5yf.public.blob.vercel-storage.com/puzzle-piece-3.jpg-3lnBkQPHzEG7p5sfLXzJIJs7Ga8v1k.png", correctPosition: 2 },
            { id: 3, src: "https://hebbkx1anhila5yf.public.blob.vercel-storage.com/puzzle-piece-4.jpg-PDEO7C9J0rUvyMa7N6GFkzetf0jdfg.png", correctPosition: 3 },
            { id: 4, src: "https://hebbkx1anhila5yf.public.blob.vercel-storage.com/puzzle-piece-5.jpg-0b3QL1CN63RIlVk09I1ZqOle1mzop4.png", correctPosition: 4 },
            { id: 5, src: "https://hebbkx1anhila5yf.public.blob.vercel-storage.com/puzzle-piece-6.jpg-R5oPCmwSzQdz5ecFb37H6ndA4JI1xg.png", correctPosition: 5 },
            { id: 6, src: "https://hebbkx1anhila5yf.public.blob.vercel-storage.com/puzzle-piece-7.jpg-TkYgY4fK7qRvEeduselJj0wHDlU3Pe.png", correctPosition: 6 },
            { id: 7, src: "https://hebbkx1anhila5yf.public.blob.vercel-storage.com/puzzle-piece-8.jpg-NstNq8fU83kIOIXX7pKLQEBX9ZThoj.png", correctPosition: 7 },
            { id: 8, src: "https://hebbkx1anhila5yf.public.blob.vercel-storage.com/puzzle-piece-9.jpg-LVclYWDbzf4OZvqpoGREFI7RlextCB.png", correctPosition: 8 }
        ];
        
        function initPuzzle() {
            // æ¸…ç©ºæ‹¼å›¾å®¹å™¨
            puzzleContainer.innerHTML = '';
            
            // æ‰“ä¹±æ‹¼å›¾é¡ºåº
            const shuffledPieces = [...puzzlePieces].sort(() => Math.random() - 0.5);
            
            // åˆ›å»ºæ‹¼å›¾
            shuffledPieces.forEach((piece, index) => {
                const img = document.createElement('img');
                img.src = piece.src;
                img.className = 'puzzle-piece';
                img.dataset.id = piece.id;
                img.dataset.correctPosition = piece.correctPosition;
                
                img.addEventListener('click', () => {
                    if (!selectedPiece) {
                        selectedPiece = img;
                        img.classList.add('selected');
                    } else {
                        // äº¤æ¢ä¸¤ä¸ªæ‹¼å›¾
                        const tempSrc = selectedPiece.src;
                        const tempId = selectedPiece.dataset.id;
                        const tempCorrectPosition = selectedPiece.dataset.correctPosition;
                        
                        selectedPiece.src = img.src;
                        selectedPiece.dataset.id = img.dataset.id;
                        selectedPiece.dataset.correctPosition = img.dataset.correctPosition;
                        
                        img.src = tempSrc;
                        img.dataset.id = tempId;
                        img.dataset.correctPosition = tempCorrectPosition;
                        
                        selectedPiece.classList.remove('selected');
                        selectedPiece = null;
                        
                        // æ£€æŸ¥æ˜¯å¦å®Œæˆæ‹¼å›¾
                        checkPuzzleCompletion();
                    }
                });
                
                puzzleContainer.appendChild(img);
            });
        }
        
        function checkPuzzleCompletion() {
            const pieces = document.querySelectorAll('.puzzle-piece');
            let isComplete = true;
            
            pieces.forEach((piece, index) => {
                if (parseInt(piece.dataset.correctPosition) !== index) {
                    isComplete = false;
                }
            });
            
            if (isComplete) {
                setTimeout(() => {
                    alert('ğŸ’– æ‹¼å›¾å®Œæˆï¼æˆ‘ä»¬çš„å›å¿†æ°¸è¿œå®Œæ•´');
                    stages.next();
                }, 500);
            }
        }

        // ç¬¬ä¸‰å…³é€»è¾‘ï¼šå¯†ç è¾“å…¥
        const codeInput = document.getElementById('codeInput');
        const finalMessage = document.getElementById('finalMessage');
        const fireworks = document.getElementById('fireworks');
        
        codeInput.addEventListener('input', function() {
            if (this.value === '1228') { // è¯·ä¿®æ”¹ä¸ºå®é™…çºªå¿µæ—¥
                finalMessage.style.display = 'block';
                createFireworks();
            }
        });
        
        function createFireworks() {
            const colors = ['#ff3366', '#ff69b4', '#ff1493'];
            
            const interval = setInterval(() => {
                const heart = document.createElement('div');
                heart.innerHTML = 'â¤ï¸';
                heart.style.cssText = `
                    position: fixed;
                    left: ${Math.random()*100}%;
                    top: ${Math.random()*100}%;
                    font-size: ${Math.random()*30+20}px;
                    color: ${colors[Math.floor(Math.random()*3)]};
                    animation: float 3s ease-out;
                    pointer-events: none;
                `;
                fireworks.appendChild(heart);
                setTimeout(() => heart.remove(), 3000);
            }, 300);
        }
    </script>
</body>
</html>